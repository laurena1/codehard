{"filter":false,"title":"google_auth.js","tooltip":"/google_auth.js","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":69,"column":15},"action":"insert","lines":["var express = require('express'),","    bodyParser = require('body-parser'),","    cookieParser = require('cookie-parser'),","    expressSession = require('express-session'),","    passport = require('passport'),","    GoogleStrategy = require('passport-google').Strategy;","passport.serializeUser(function(user, done) {","    done(null, user);","});","passport.deserializeUser(function(obj, done) {","    done(null, obj);","});","passport.use(new GoogleStrategy({","        returnURL: 'http://localhost/auth/google/return',","        realm: 'http://localhost/'","    },","    function(identifier, profile, done) {","        process.nextTick(function() {","            profile.identifier = identifier;","            return done(null, profile);","        });","    }","));","var app = express();","app.engine('.html', require('ejs').__express);","app.set('views', __dirname + '/views');","app.set('view engine', 'html');","app.use(bodyParser.urlencoded({","    extended: true","}));","app.use(bodyParser.json());","app.use(cookieParser());","app.use(expressSession({","    secret: 'SECRET'","}));","app.use(passport.initialize());","app.use(passport.session());","app.use(express.static(__dirname + '/static'));","app.get('/login', function(req, res) {","    if (req.isAuthenticated()) {","        res.redirect('/info');","    }","    else {","        res.render('login', {","            user: req.user","        });","    }","});","app.get('/auth/google',","    passport.authenticate('google'));","app.get('/auth/google/return',","    passport.authenticate('google', {","        successRedirect: '/info',","        failureRedirect: '/login'","    }));","app.get('/logout', function(req, res) {","    req.logout();","    res.redirect('/login');","});","app.get('/info', function(req, res) {","    if (req.isAuthenticated()) {","        res.render('info', {","            user: req.user","        });","    }","    else {","        res.redirect('/login');","    }","});","app.listen(80);"]}]}]]},"ace":{"folds":[],"scrolltop":456,"scrollleft":0,"selection":{"start":{"row":69,"column":15},"end":{"row":69,"column":15},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":31,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1416734137410,"hash":"4f9375d59b06f4f35c6d8d9a8e1122832da2f9b9"}